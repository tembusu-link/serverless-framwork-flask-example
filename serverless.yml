org: tembusu
app: serverless-framework-test
service: serverless-framework-test
configValidationMode: error
useDotenv: true

frameworkVersion: '3'

provider:
  name: aws
  runtime: python3.9
  profile: tembusu
  memorySize: 128
  timeout: 10
  logRetentionInDays: 14
  architecture: arm64

custom:
  wsgi:
    app: app.app
  customDomain:
    http:
      domainName: ${env:SUBDOMAIN}.tembusu.link
      certificateName: '*.tembusu.link'
      createRoute53Record: true
      createRoute53IPv6Record: true
      endpointType: 'regional'
      securityPolicy: tls_1_2
      region: us-east-1
      autoDomain: true
  prune:
    automatic: true
    number: 3



functions:
  api:
    handler: wsgi_handler.handler
    layers:
      - arn:aws:lambda:us-east-1:580247275435:layer:LambdaInsightsExtension-Arm64:2
    events:
      - httpApi: '*'
  cronJob:
    handler: app.hello_cron
    timeout: 300
    events:
      - schedule:
          name: cron-say-hello
          description: a description of my scheduled event's purpose
          # Can also be an array of rate/cron expressions
          rate: rate(20 minutes)
          # (default: true)
          enabled: true



plugins:
  - serverless-wsgi
  - serverless-python-requirements
  - serverless-domain-manager
  - serverless-prune-plugin
  - serverless-dotenv-plugin
